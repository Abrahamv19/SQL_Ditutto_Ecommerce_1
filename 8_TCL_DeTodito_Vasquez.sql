-- SCRIPT DE 2 TCL

USE detodito_ecommerce ;
SELECT @@autocommit;

SET @@autocommit = 0;

-- NO HAY NECESIDAD DE DESHABILITYAR LAS FK
-- SELECT @@FOREIGN_KEY_CHECKS;

-- TABLA 1 -CLIENTES: INSERTAR 4 REGISTROS NUEVOS - ELIMINA ESOS 4 NUEVOS REGISTROS, INICIANDO
-- PREVIAMENTE UNA TRANSACCION. DEJA EN UNA LINEA SIGUIENTE, COMENTADO LA SENTENCIA ROLLBACK
-- Y EN UNA LINEA POSTERIOR LA SENTENCIA COMMIT
SELECT * FROM CLIENTES ;

-- PRIMERO VOY A INGRESAR 4 NUEVOS REGISTROS PARA NO AFECTAR LA TABLA EXISTENTE
INSERT INTO `CLIENTES` VALUES (18,14,NULL,9,'alejo','mosh','alejo@g.com','311460081','2024-03-14'),(19,13,NULL,11,'marta','duss','marta2@g.com','311460082','2024-03-15'),(20,12,NULL,3,'paty','pett','paty2@g.com','311460083','2024-03-16'),(21,11,NULL,5,'cristobal','lerma','cristobal@g.com','311460099','2024-03-17');
SELECT * FROM CLIENTES ;

-- INICIO LA TRANSACCION
START TRANSACTION;

DELETE FROM CLIENTES
WHERE id_cliente BETWEEN 18 AND 21;
SELECT * FROM CLIENTES ;

-- ROLLBACK ;
-- COMMIT ;
SELECT * FROM CLIENTES ;


-- """"""""""""""""""""""""""""""""""""""""""""""""""
-- TABLA 2 -PAIS: INSERTAR 8 REGISTROS NUEVOS - INICIA UNA TRANSACCION. AGREGA UN SAVEPOINT A 
-- POSTERIORI DE LA INSERCION DEL REGSITRO #4 Y OTRO SAVEPOINT A POSTERIORI DEL REGISTRO #8
-- AGREGA EN UNA LINEA COMENTADA LA SENTENCIA DE ELIMINACION DEL SAVEPOINT DE LOS PRIMEROS 4
-- REGISTROS INSERTADOS 
SELECT * FROM PAIS ;

-- INICIO LA TRANSACCION
START TRANSACTION;

INSERT INTO `PAIS` VALUES (18,'venezuela','suramerica','castellano',30000000,'TROPICAL',1242000,30000,'2023-04-24'),(19,'salvador','centro america','castellano',3000000,'TROPICAL',73000,4000,'2023-04-25'),(20,'vietnam','asia','vietnamita',25000000,'ESTACIONES',77000,5000,'2023-04-26'),(21,'austria','europa','aleman',33000000,'ESTACIONES',257000,10000,'2023-04-27');
SAVEPOINT sp1;

INSERT INTO `PAIS` VALUES (22,'malasya','asia','malayo',31000000,'ESTACIONES',80000,50000,'2023-04-27'),(23,'irak','asia','arabe',3000000,'CALIENTE',1000000,10000,'2023-04-28'),(24,'nicaragua','centro america','castellano',5000000,'ESTACIONES',85000,9000,'2023-04-20'),(25,'italia','europa','italiano',80000000,'ESTACIONES',410000,10000,'2023-04-30');
SAVEPOINT sp2;

SELECT * FROM PAIS ;

-- ROLLBACK TO sp1 ;
SELECT * FROM PAIS ;

-- elimina el SAVEPOINT
release SAVEPOINT sp1; 
SELECT * FROM PAIS ;